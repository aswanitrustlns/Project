<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8" />
    <title>Trust Capital CRM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />
    {% load  static %}
    {% include "common/link.html" %}
    {% include "common/scripts.html" %}
    
</head>
<body data-layout-mode="dark">
    <audio id="Player" autoplay>
        <source src="{% static 'audio/speech.wav' %}"/>
   </audio>
    <!-- <body data-layout="horizontal"> -->
    
    <!-- Begin page -->
    <div id="layout-wrapper">
        {% include "common/header.html" %}
        
    
        <!-- ========== Left Sidebar Start ========== -->
        {% include "common/sidebar.html" %}
         <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content" id="sales">
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                    <h4 class="mb-sm-0 fs-23 almarenamonolight-type">Email Inbox</h4><!--font-size-18-->

                                    <!--<div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Email</a></li>
                                            <li class="breadcrumb-item active">Email Inbox</li>
                                        </ol>
                                    </div>-->

                                </div>
                            </div>
                        </div>
                        <!-- end page title -->
                        
                        <div class="row">
                            <div class="col-12">
                                <!-- Left sidebar -->
                                <div class="email-leftbar card">
                                    <!--<button type="button" class="btn btn-danger w-100 waves-effect waves-light" data-bs-toggle="modal" data-bs-target="#composemodal">
                                        Compose
                                    </button>-->
                                    <div class="mail-list mt-0">
                                        <a  class="  text-white gilroyregular-type fs-16">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" >
                                                <path d="M16.5 7.875V11.625C16.5 14.25 15 15.375 12.75 15.375H5.25C3 15.375 1.5 14.25 1.5 11.625V6.375C1.5 3.75 3 2.625 5.25 2.625H10.5" stroke="white" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M5.25 6.75L7.5975 8.625C8.37 9.24 9.6375 9.24 10.41 8.625L11.295 7.92" stroke="white" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M14.625 6C15.6605 6 16.5 5.16053 16.5 4.125C16.5 3.08947 15.6605 2.25 14.625 2.25C13.5895 2.25 12.75 3.08947 12.75 4.125C12.75 5.16053 13.5895 6 14.625 6Z" stroke="white" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                
                                            Inbox <span class="badge  rounded-pill rounded-circle p-2 fs-11 float-end" style="background-color:
                                            #FF7C48 ;">{{count}}</span> </a>
                                        <!--<a href="#"><i class="mdi mdi-star-outline me-2"></i>Starred</a>
                                        <a href="#"><i class="mdi mdi-diamond-stone me-2"></i>Important</a>
                                        <a href="#"><i class="mdi mdi-file-outline me-2"></i>Draft</a>
                                        <a href="#"><i class="mdi mdi-email-check-outline me-2"></i>Sent Mail</a>
                                        <a href="#"><i class="mdi mdi-trash-can-outline me-2"></i>Trash</a>-->
                                    </div>
                                 
                                    
                                </div>
                                <!-- End Left sidebar -->
        
        
                                <!-- Right Sidebar -->
                                <div class="email-rightbar mb-3">
                                    
                                    <div class="card" id="inbox_div">
                                        
                                        <ul class="message-list" data-simplebar style="max-height: 700px;" id="mailList">
                                        {% for mail in mails%}
                                             
                                            <!-- <li class="fs-16" onclick='window.location.href="{% url 'Admin:Read' %}?message={{mail.3}}"' style="cursor: pointer;"> -->
                                            <li class="fs-16" style="cursor: pointer;" data-id="{{mail.3}}">
                                                <div class="col-mail col-mail-1">
                                                    <div class="checkbox-wrapper-mail">
                                                        <input type="checkbox" id="chk1">
                                                        <label for="chk1" class="toggle"></label>
                                                    </div>
                                                    <a class="title text-white gilroysemibold-type">{{mail.1}}</a><span class="star-toggle far fa-star" style="color:var(--color1) ;"></span>
                                                </div>
                                                <div class="col-mail col-mail-2">
                                                    <a class="subject color-color1 gilroyregular"><span class="teaser">{{mail.0}}</span>
                                                    </a>
                                                    <div class="date text-white gilroymedium-type" style="width:250px ;">{{mail.2}}</div>
                                                </div>
                                            </li>
                                            <hr class="mx-3 my-0">
                                            
                                           
                                           {%endfor%}
        
                                        </ul>
        
                                    </div> <!-- card -->
        
                                    <div class="row">
                                        <div class="col-7 gilroymedium-type fs-16" id="showCount">
                                            Showing 1 - {{count}} 
                                        </div>
                                        <!-- <div class="col-5">
                                            <div class="btn-group float-end">
                                                <button type="button" class="btn btn-sm btn-success waves-effect" onclick="paginateInbox('sub')"><i class="fa fa-chevron-left"></i></button>
                                                <button type="button" class="btn btn-sm btn-success waves-effect" onclick="paginateInbox('add')"><i class="fa fa-chevron-right"></i></button>
                                            </div>
                                        </div> -->
                                    </div>
                                </div> <!-- end Col-9 -->
        
                            </div>
        
                        </div><!-- End row -->
                    </div> <!-- container-fluid -->
                </div>
                <!-- End Page-content -->

                <!-- Modal -->
                <div class="modal fade" id="composemodal" tabindex="-1" role="dialog" aria-labelledby="composemodalTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title font-size-16" id="composemodalTitle">New Message</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div>
                                    <div class="mb-3">
                                        <input type="email" class="form-control" placeholder="To">
                                    </div>

                                    <div class="mb-3">
                                        <input type="text" class="form-control" placeholder="Subject">
                                    </div>
                                    <div class="mb-3 email-editor">
                                        <div id="email-editor"></div>
                                    </div>

                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary">Send <i class="fab fa-telegram-plane ms-1"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end modal -->

                
            </div>
    </div>
    {% include "common/right-sidebar.html" %}
    <div class="rightbar-overlay"></div>
    <script>


        count=0
        start_i=0
        end_i=0
        var inbox_items={{data|safe}}
        var inbox_count={{count|safe}}
        console.log("Inbox items----"+inbox_items)


        $(function(){
            $('#mailList').on('click','li', function(event){
                event.preventDefault();
                ms_id=$(this).data("id")
                console.log(ms_id);
                readMessage(ms_id)
            });
        })

        function paginateInbox(message){

            if(message=='add'){
                count=count+20
                count_end=count+20
                start_i=count
                end_i=count_end
                if(count_end > inbox_count){
                    end_i=inbox_count-count
                    end_i=start_i+end_i
                }
                
            }
            if(message=='sub'){
                count=count-20
                count_end=count_end-20
                start_i=count
                end_i=count_end
                if(count==0 || count < 0){
                    count=0
                    count_end=20
                    end_i=20
                }
                
            }
            // $('#inbox_div ul li').remove();
            $("#mailList").empty();
            console.log("Count--------------------"+count)
            console.log("Start--------------------"+start_i)
            console.log("End-------------------------"+end_i)
            
            var inboxlist=""

            for(var i=start_i;i<end_i;i++){ 
                
                    
                    var ms_id=""
                    inboxlist +="<li class='fs-16' data-id='"+ms_id+"' style='cursor: pointer' >"+
                                "<div class='col-mail col-mail-1'><div class='checkbox-wrapper-mail'><input type='checkbox' id='chk1'><label for='chk1' class='toggle'></label>"+
                                "</div><a class='title text-white gilroysemibold-type'>"+inbox_items[i][1]+"</a><span class='star-toggle far fa-star' style='color:var(--color1) ;''></span>"+
                                "</div><div class='col-mail col-mail-2'><a class='subject color-color1 gilroyregular'><span class='teaser'>"+inbox_items[i][0]+"</span></a>"+
                                "<div class='date text-white gilroymedium-type' style='width:250px ;'>"+inbox_items[i][2]+"</div></div></li><hr class='mx-3 my-0'>";
                    
                
            }
            $("#mailList").append(inboxlist)
            document.getElementById("showCount").innerHTML= "Showing "+count +"-"+count_end+" of "+inbox_count          

        }
        function readMessage(ms_id){

            console.log("Read msg called")
            var url="{% url 'Admin:Read'%}?message="+ms_id
            window.location.href=url
            return false
        }

    </script>


    <script src="{%static 'js/app.js' %}"></script>

</body>
</html>
