<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8" />
    <title>Trust Capital CRM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />

    {% load  static %}
    <link href="{% static 'libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- plugin css -->
    <!--<link href="assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet"
        type="text/css" />-->
     <!-- datepicker css -->
     <link rel="stylesheet" href="{% static 'libs/flatpickr/flatpickr.min.css' %}">
    {% include "common/link.html" %}
   
    {% include "common/scripts.html" %}
    <script src="{%static 'js/pages/datatables-filtercolumn-nwaccountsales.init.js' %}"></script> 
    
</head>
<body data-layout-mode="dark">

    <!-- <body data-layout="horizontal"> -->
    
    <!-- Begin page -->
    <div id="layout-wrapper">
        {% include "common/header.html" %}
        
    
        <!-- ========== Left Sidebar Start ========== -->
        {% include "common/sidebar.html" %}
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">
        
        <div class="page-content" id="sales">
            <div class="container-fluid"> <!--container-fluid px-md-5 me-md5-->

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                            <h4 class="mb-sm-0 fs-23 almarenamonolight-type">New Accounts</h4><!--font-size-18-->

                            <!--<div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                    <li class="breadcrumb-item active">New Accounts</li>
                                </ol>
                            </div>-->

                        </div>
                    </div>
                </div>
                <!-- end page title -->
                <!--Analytics overview-->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                           
                            <div class="card-body ">
                               
                                <div class=" d-flex justify-content-between align-items-start">
                                    <div>
                                        <button type="button" class="btn btn-lg btn-primary   mb-3  mx-1 gilory-semibold-type bg-soft-purple text-white" id="Lives" style="background-color: var(--bs-card-bg) ;" onclick="addColor(this,'bg-soft-purple text-white', 'color-color1');changeAccount('Live');switchtab(this,'#accounts_table','#rejected_table','#terminated_table','#closed_table')">Live</button>
                                        <button type="button" class="btn btn-lg btn-primary  color-color1 mb-3 mx-1 gilory-semibold-type"  id="Pendings" style="background-color: var(--bs-card-bg); "  onclick="addColor(this,'bg-soft-purple text-white', 'color-color1');changeAccount('Pending');switchtab(this,'#accounts_table','#rejected_table','#terminated_table','#closed_table')">Pending</button>
                                        <button type="button" class="btn btn-lg btn-primary  color-color1 mb-3 mx-1 gilory-semibold-type"  id="Rejected" style="background-color: var(--bs-card-bg) ;" onclick="addColor(this,'bg-soft-purple text-white','color-color1');changeAccount('Rejected');switchtab(this,'#rejected_table','#accounts_table','#terminated_table','#closed_table')">Rejected</button>
                                        <!-- <button type="button" class="btn btn-lg btn-primary  color-color1 mb-3 mx-1 gilory-semibold-type"  id="Terminated" style="background-color: var(--bs-card-bg) ;"  onclick="addColor(this,'bg-soft-purple text-white','color-color1');changeAccount('Terminated');switchtab(this,'#terminated_table','#rejected_table','#accounts_table','#closed_table')">Terminated</button> -->
                                        <button type="button" class="btn btn-lg btn-primary  color-color1 mb-3 mx-1 gilory-semibold-type"  id="Closed" style="background-color: var(--bs-card-bg) ;"  onclick="addColor(this,'bg-soft-purple text-white','color-color1');changeAccount('Closed');switchtab(this,'#closed_table','#accounts_table','#terminated_table','#rejected_table')">Closed</button>
                                        <input type="hidden" name="selected_tab" id="selected_tab" value="Live">
                                    </div>
                                    
                                    <div class=" mt-2  mt-md-0">
                                       
                                            <div class="row align-items-end justify-content-end">


                                                    <div class="col-sm-3">
                                                        <div class="mb-2">
                                                            <label class="form-label " for="fromdate">From Date</label>
                                                            <input type="text" id="fromdate" class="py-1" name="fromdate">
    
                                                           
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">

                                                        <div class="mb-2">
                                                            <label class="form-label " for="todate">To Date</label>
    
                                                            <input type="text" id="todate" class="py-1" name="todate">
                                                            
                                                        </div>




                                                    </div>
                                                    <div class="col-sm-3 ">
                                                        <button class="btn btn-info btn-md mb-2 py-1" type="button" onclick="changeAccount('All');" id="load-btn">Load</button>
                                                    </div>
                                            </div>
                                        
                                    </div>
                                   
                                    
                                </div>

                                <div class="mb-4 mt-3 " id="live">

                                    <ul class="gilory-medium-type list-unstyled color-color1 fs-18 d-flex ">

                                        <li onclick="pageRedirect('Funded')" style="cursor:pointer"> <span class="rounded-circle  bg-danger d-inline-block me-1 "  style="height:13px ;width:13px;"></span><span>Funded</span> | <span class="text-white" id="fundspan">{{accounts_count.0}}</span></li>
                                        <li class="ms-5" onclick="pageRedirect('NonFunded')" style="cursor:pointer"> <span class="rounded-circle  bg-info d-inline-block me-1" style="height:13px ;width:13px;"></span> <span>Non Funded </span> | <span class="text-white" id="nonfundspan">{{accounts_count.1}}</span></li>
                                    </ul>
                                </div>
                                <div class="mb-4 mt-3 " id="pending">

                                    <ul class="gilory-medium-type list-unstyled color-color1 fs-18 d-flex ">

                                        <li onclick="pageRedirect('TempApproved')" style="cursor:pointer"> <span class="rounded-circle  bg-danger d-inline-block me-1 "  style="height:13px ;width:13px;"></span><span>Approved Temporarily</span> | <span class="text-white" id="approvespan">{{accounts_count.2}}</span></li>
                                        <li class="ms-5" onclick="pageRedirect('WaitingApproval')" style="cursor:pointer"> <span class="rounded-circle  bg-info d-inline-block me-1" style="height:13px ;width:13px;"></span> <span>Waiting for approval</span> | <span class="text-white" id="waitingspan">{{accounts_count.3}}</span></li>
                                    </ul>
                                </div>

                                <hr class="my-0">
                                
                                <div class=" px-1 table-responsive mt-4 d-block" id="accounts_table">
                                    <table id="datatableleads" class="table dt-responsive  nowrap  w-100">
                                        <thead>
                                            <tr  class=" ">
                                                <!-- <th  data-text="text" class="filterhead">Promo</th> -->
                                                <th data-id="datepicker-range" class="filterhead">RegDate</th>
                                                <th  data-text="text" class="filterhead">Promo</th>
                                                
                                                <th  data-timer="option" class="filterhead">Login</th>
                                                <th  data-text="text" class="filterhead">Name</th>
                                                <th  data-text="text" class="filterhead">Email</th>
                                                <th  data-text="text" class="filterhead">Source</th>
                                                <th  data-text="text" class="filterhead">SalesRep</th>
                                                <th  data-text="text" class="filterhead">Ticket</th>
                                                <th  data-text="text" class="filterhead ">Country</th>
                                            </tr>
                                        </thead>


                                        <tbody id="newaccounts_data">
                                            {%for data in accounts_data %}   
                                        <tr>
                                            <td>{{data.1}}</td>
                                            <td>{{data.0}} </td>
                                            
                                            <td>{{data.2}}</td>
                                            <td>{{data.3}}</td>
                                            <td>{{data.4}}</td>
                                            <td>{{data.5}}</td>
                                            <!-- <td>{{data.6}}</td> -->
                                            <td>{{data.6}}</td>
                                            <td>{{data.9}}</td>
                                            <td class="text-end">{{data.8}}</td>
                                        </tr>
                                            {%endfor%}
                                        
                                        </tbody>
                                        <tfoot>
                                            
                                        </tfoot>
                                    </table>
                                </div>
                                <div class=" px-1 table-responsive mt-4 d-none" id="rejected_table">
                                    <table id="datatableleadsR" class="table dt-responsive  nowrap  w-100">
                                        <thead>
                                            <tr  class=" ">
                                                <!-- <th data-id="datepicker-range-reject" class="filterhead">RegDate</th> -->
                                                <th data-text="text" class="filterhead">RegDate</th>
                                                <th  data-text="text" class="filterhead">Promo</th>
                                                <th  data-text="text" class="filterhead">Rejectd</th>
                                                <th  data-timer="option" class="filterhead">Login</th>
                                                <th  data-text="text" class="filterhead">Name</th>
                                                <th  data-text="text" class="filterhead">Email</th>
                                                <th  data-text="text" class="filterhead">Source</th>
                                                <th  data-text="text" class="filterhead">Currency</th>
                                                <th  data-text="text" class="filterhead">Country</th>                                                
                                                <th  data-text="text" class="filterhead">Ticket</th>
                                                <th  data-text="text" class="filterhead">IP</th>
                                            </tr>
                                        </thead>


                                        <tbody>
                                      
                                        
                                        </tbody>
                                        <tfoot>
                                            
                                        </tfoot>
                                    </table>
                                </div>
                                <div class=" px-1 table-responsive mt-4 d-none" id="terminated_table">
                                    <table id="datatableleadsT" class="table dt-responsive  nowrap  w-100">
                                        <thead>
                                            <tr  class=" ">
                                             
                                                <th data-text="text" class="filterhead">RegDate</th>
                                                <th data-text="text" class="filterhead">Terminated</th>
                                                <th  data-text="text" class="filterhead">Login</th>
                                                <th  data-text="text" class="filterhead">Name</th>
                                                <th  data-text="text" class="filterhead">Email</th>
                                                <th  data-text="text" class="filterhead">Source</th>
                                                <th  data-text="text" class="filterhead">Currency</th>
                                                <th  data-text="text" class="filterhead">Country</th>
                                                <th  data-text="text" class="filterhead">Ticket</th>
                                                <th  data-text="text" class="filterhead">IP</th>
                                            </tr>
                                            <!-- <tr class="filters" role="row">
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="Promo" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="subscribe" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="RegDate" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="Terminated" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text"  placeholder="Login" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text"  placeholder="Name" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="Email" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="Source" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="Currency" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="Ticket" class="fs-14">
                                                </th>
                                                <th data-text="text" class="filterhead" rowspan="1" colspan="1">
                                                    <input type="text" placeholder="IP" class="fs-14">
                                                </th>
                                            </tr> -->
                                        </thead>


                                        <tbody>
                                           
                                        
                                        </tbody>
                                        <tfoot>
                                            
                                        </tfoot>
                                    </table>
                                </div>
                                <div class=" px-1 table-responsive mt-4 d-none" id="closed_table">
                                    <table id="datatableleadsC" class="table dt-responsive  nowrap  w-100">
                                        <thead>
                                            <tr  class=" ">
                                                
                                                <th data-id="datepicker-range" class="filterhead">RegDate</th>
                                                <th  data-text="text" class="filterhead">Closed</th>
                                                <th  data-text="text" class="filterhead">Closed By</th>
                                                <th  data-timer="option" class="filterhead">Login</th>
                                                <th  data-text="text" class="filterhead">Name</th>
                                                <th  data-text="text" class="filterhead">Email</th>
                                                <th  data-text="text" class="filterhead">Source</th>
                                                <th  data-text="text" class="filterhead">Currency</th>
                                                <th  data-text="text" class="filterhead">Country</th>
                                                <th  data-text="text" class="filterhead">Ticket</th>
                                                <th  data-text="text" class="filterhead">IP</th>
                                            </tr>
                                        </thead>


                                        <tbody id="newaccounts_data">
                                      
                                        
                                        </tbody>
                                        <tfoot>
                                            
                                        </tfoot>
                                    </table>
                                </div>

                                

                            </div>
                        </div>
                    </div> <!-- end col -->



                </div>
                <!-- end row-->

                </div>
                <!-- container -->
            </div>
            <!-- End Page-content -->

            
        </div>
 {% include "common/right-sidebar.html" %}
 <div class="rightbar-overlay"></div>

    <script>
        var tabactive={{active|safe}}
        var role={{role|safe}}
        console.log("Active============="+tabactive)

        $(function(){
    
    $('#datatableleads tbody').on('click', 'tr', function (e) {
        var table = $("#datatableleads").DataTable();
        console.log("row clicked----")
        var data = table.row( this ).data();       
        console.log("Ticket----------"+data[7])  
        var ticket=data[7]
        if(role=="backoffice"){
            var url="{% url 'Backoffice:Manage'%}"
            window.location.href=url+"?&ticket="+ticket

        }else{
            var url="{% url 'Admin:LeadProcessing'%}"
            window.location.href=url+"?&ticket="+ticket
        }
        
    })
    $('#datatableleadsR tbody').on('click', 'tr', function (e) {
        var table = $("#datatableleadsR").DataTable();
        console.log("row clicked----")
        var data = table.row( this ).data();       
        console.log("Ticket----------"+data[8])  
        var ticket=data[8]
        if(role=="backoffice"){
            var url="{% url 'Backoffice:Manage'%}"
            window.location.href=url+"?&ticket="+ticket

        }else{
        var url="{% url 'Admin:LeadProcessing'%}"
        window.location.href=url+"?&ticket="+ticket
        }
    })
    $('#datatableleadsT tbody').on('click', 'tr', function (e) {
        var table = $("#datatableleadsT").DataTable();
        console.log("row clicked----")
        var data = table.row( this ).data();       
        console.log("Ticket----------"+data[8])  
        var ticket=data[8]
        if(role=="backoffice"){
            var url="{% url 'Backoffice:Manage'%}"
            window.location.href=url+"?&ticket="+ticket

        }else{
        var url="{% url 'Admin:LeadProcessing'%}"
        window.location.href=url+"?&ticket="+ticket
        }
    })
    $('#datatableleadsC tbody').on('click', 'tr', function (e) {
        var table = $("#datatableleadsC").DataTable();
        console.log("row clicked----")
        var data = table.row( this ).data();       
        console.log("Ticket----------"+data[6])  
        var ticket=data[9]
        if(role=="backoffice"){
            var url="{% url 'Backoffice:Manage'%}"
            window.location.href=url+"?&ticket="+ticket

        }else{
        var url="{% url 'Admin:LeadProcessing'%}"
        window.location.href=url+"?&ticket="+ticket
        }
    })
})


        
            function changeAccount(change){

                if(change!='All'){
                    $("#selected_tab").val(change)
                }
               var status=$("#selected_tab").val()
                console.log("changed status----"+status)
                console.log("Onclick change----------------------"+change)
                if((change=="Rejected" || change =="All") &&status=="Rejected"){
                    $("#live").hide()
                    $("#pending").hide()
                    rejectedAccount(change,status);
                }
                if((change=="Closed" || change =="All" ) && status=="Closed"){
                    $("#live").hide()
                    $("#pending").hide()
                    closedAccount(change,status)
                }
                if((change=="Terminated"|| change =="All") && status=="Terminated"){
                    $("#live").hide()
                    $("#pending").hide()
                    terminateAccount(change,status)
                }
                if(change=="Live" || change =="Pending" || change =="All" || status=="Live" || status=="Pending"){
                    if((change=="Live" || change =="All" ) && status=="Live"){
                        $("#live").show()
                        $("#pending").hide()
                    }
                    if((change=="Pending" || change =="All") && status=="Pending"){
                        $("#live").hide()
                        $("#pending").show()
                    }
                    liveAccount(change,status)
                }                
                

            }
            function liveAccount(change,status){
            fromdate=document.getElementById("fromdate").value
            todate=document.getElementById("todate").value
            var json_data;
                $("#datatableleads").DataTable({
                'paging':true, 
                'destroy': true,               
                'ajax':{
                   "url": "{% url 'Admin:NewAccounts' %}",
                   "type": "GET",
                   "data":{
                    'change':change,
                    'from':fromdate,
                    'to':todate,
                    'status':status,
                   },
                   "dataSrc":function(data){
                    json_data=data.data
                    count=data.count
                    console.log("Count========="+count[0])
                    var fundspan=document.getElementById("fundspan")
                    var nonfundspan=document.getElementById("nonfundspan")
                    var approvespan=document.getElementById("approvespan")
                    var waitingspan=document.getElementById("waitingspan")
                    fundspan.innerHTML=count[0]
                    nonfundspan.innerHTML=count[1]
                    approvespan.innerHTML=count[2]
                    waitingspan.innerHTML=count[3]
                    var items = [];
                    for ( var i=0, ien=json_data.length ; i<ien ; i++ ) {

                        items[i] = [json_data[i][1],json_data[i][0],json_data[i][2],json_data[i][3],json_data[i][4],json_data[i][5],json_data[i][6],json_data[i][9],json_data[i][8]]; 
                            
                        }
                        
                        return items;
                   }
                },
                responsive: true,
                orderCellsTop: true,
                fixedHeader: true,
                initComplete: function () {
                    var api = this.api();
     
                        api
                        .columns()
                        .eq(0)
                        .each(function (colIdx) {
                        var column = this;
             // Set the header cell to contain the input element

                 var cell = $('.filters th').eq(
                 $(api.column(colIdx).header()).index()
             );
             var $myindex=$(api.column(colIdx).header()).index();
             var $myhead=$("#datatableleads thead tr th").eq($myindex);
             var title = $myhead.text();
             var id = $myhead.attr('data-id');
             //var datatext=$(cell).attr('data-text');
             var select1 = $('<select   id="' + id + '" placeholder="' + title + '"  class="fs-14 form-control w-100"><option value=""></option></select>');
             if ($(cell).attr('data-text') == 'select') {
                 //console.log($(cell).index());
                 api.column($(cell).index())
                     .data()
                     .unique()
                     .sort()
                     .each(function (d, j) {


                         select1.append('<option value="' + d + '">' + d + '</option>');

                     });
                 $(cell).html(select1);




             } else {
                 $(cell).html('<input type="text" id="' + id + '" placeholder="' + title + '"  class="fs-14"   />');
             }


             // On every keypress in this input
             $(
                 'input',
                 $('.filters th').eq($(api.column(colIdx).header()).index())
             )
                 .off('keyup change')
                 .on('change', function (e) {

                     if ($(this).attr('id') == 'datepicker-range') {
                         console.log("Heloooo");

                         //var vals=this.value ;



                     } else {
                         //console.log($(this).attr('id'));


                         // Get the search value
                         $(this).attr('title', $(this).val());

                         //var vals=this.value ;

                         var regexr = '({search})'; //$(this).parents('th').find('select').val();

                         var cursorPosition = this.selectionStart;
                         // Search the column for that value
                         api
                             .column(colIdx)
                             .search(
                                 this.value != ''
                                     ? regexr.replace('{search}', '(((' + this.value + ')))')
                                     : '',
                                 this.value != '',
                                 this.value == ''
                             )
                             .draw();

                     }


                 })
                 .on('keyup', function (e) {
                     e.stopPropagation();

                     $(this).trigger('change');
                     $(this)
                         .focus()[0]
                         .setSelectionRange(cursorPosition, cursorPosition);
                 });

             $(
                 'select',
                 $('.filters th').eq($(api.column(colIdx).header()).index())
             )
                 .off('keyup change')
                 .on('change', function (e) {

                     if ($(this).attr('id') == 'datepicker-range') {
                         console.log("Heloooo");

                         //var vals=this.value ;



                     } else {
                         //console.log($(this).attr('id'));


                         // Get the search value
                         $(this).attr('title', $(this).val());

                         //var vals=this.value ;

                         var regexr = '({search})'; //$(this).parents('th').find('select').val();

                         var cursorPosition = this.selectionStart;
                         // Search the column for that value
                         api
                             .column(colIdx)
                             .search(
                                 this.value != ''
                                     ? regexr.replace('{search}', '(((' + this.value + ')))')
                                     : '',
                                 this.value != '',
                                 this.value == ''
                             )
                             .draw();

                     }

                 })
                 .on('keyup', function (e) {
                     e.stopPropagation();

                     $(this).trigger('change');
                     $(this)
                         .focus()[0]
                         .setSelectionRange(cursorPosition, cursorPosition);
                 });
         });
         flatpikrCall("datatableleads")
 },
                
               
            });     
            
           
        }





function rejectedAccount(change,status){
            fromdate=document.getElementById("fromdate").value
            todate=document.getElementById("todate").value
           $("#fromdate").val("")
            $('#datatableleadsR').dataTable().fnClearTable();
                $('#datatableleadsR').dataTable().fnDestroy();
            
                $("#datatableleadsR").DataTable({
                // 'processing' : true,
                
                'paging':true,               
                'ajax':{
                   "url": "{% url 'Admin:NewAccounts' %}",
                   "type": "GET",
                   "data":{
                    "change":change,
                    'from':fromdate,
                    'to':todate,
                    'status':status,
                   },
                   "dataSrc":function(data){
                    json_data=data.data
               
                    var items = [];
                    for ( var i=0, ien=json_data.length ; i<ien ; i++ ) {

                        items[i] = [json_data[i][0],json_data[i][1],json_data[i][2],json_data[i][3],json_data[i][4],json_data[i][5],json_data[i][6],json_data[i][7],json_data[i][8],json_data[i][9]]; 
                            
                        }
                        
                        return items;
                   }
                },
                responsive: true,
        orderCellsTop: true,  

       
        fixedHeader: true,
        initComplete: function () {
            var api = this.api();
 
            // For each column
            api
                .columns()
                .eq(0)
                
                .each(function (colIdx) {
                   
                    // Set the header cell to contain the input element
                  
                    var cell = $('.filters th').eq(
                        $(api.column(colIdx).header()).index()
                    );
                    var title = $(cell).text();
                    var id = $(cell).attr('data-id');
                    
                    $(cell).html('<input type="text" id="'+id+'" placeholder="' + title + '"  class="fs-14"   />');
                    
                    // On every keypress in this input
                    $(
                        'input',
                        $('.filters th').eq($(api.column(colIdx).header()).index())
                    )
                        .off('keyup change')
                        .on('change', function (e) {

                            console.log($(this).attr('id'));

                            if($(this).attr('id')=='datepicker-range'){
                                
                                api
                                .column(colIdx)
                                .search(
                                        function( data, colIdx ) {
                                            //var min = minDate;
                                            // var max = maxDate;
                                            // console.log(min);
                                                //date = new Date( colIdx[0] );
                                            var min = minDate;
                                            var max = maxDate;
                                            var date = new Date(data[0]);
                                            

                                            //colIdx
                                     
                                            if (
                                                ( min === null && max === null ) ||
                                                ( min === null && date <= max ) ||
                                                ( min <= date   && max === null ) ||
                                                ( min <= date   && date <= max )
                                            ) {
                                                return true;
                                                console.log('searching-date-start' +min  );
                                                console.log('searching-date-endt' +max  );
                                            }
                                            return false;
                                            console.log('searching-date-start' +min  );
                                            console.log('searching-date-endt' +max  );
                                        }
                                    
                                ).draw();
                               

                                
                            }
                            else{

                                    // Get the search value
                                $(this).attr('title', $(this).val());
                                var regexr = '({search})'; //$(this).parents('th').find('select').val();
                                var cursorPosition = this.selectionStart;
                                // Search the column for that value
                                api
                                .column(colIdx)
                                .search(
                                    this.value != ''
                                        ? regexr.replace('{search}', '(((' + this.value + ')))')
                                        : '',
                                    this.value != '',
                                    this.value == ''
                                )
                                .draw();


                            }
                            
                        })
                        .on('keyup', function (e) {
                            e.stopPropagation();
 
                            $(this).trigger('change');
                            $(this)
                                .focus()[0]
                                .setSelectionRange(cursorPosition, cursorPosition);
                        });
                });
                
        },
                
               
            });     
            flatpikrCall("datatableleadsR")
        }



        function closedAccount(change,status){
            fromdate=document.getElementById("fromdate").value
            todate=document.getElementById("todate").value
            $('#datatableleadsC').dataTable().fnClearTable();
                $('#datatableleadsC').dataTable().fnDestroy();
                $("#datatableleadsC").DataTable({
                // 'processing' : true,
                
                'paging':true,               
                'ajax':{
                   "url": "{% url 'Admin:NewAccounts' %}",
                   "type": "GET",
                   "data":{
                    "change":change,
                    'from':fromdate,
                    'to':todate,
                    'status':status,
                   },
                   "dataSrc":function(data){
                    json_data=data.data
               
                    var items = [];
                    for ( var i=0, ien=json_data.length ; i<ien ; i++ ) {

                        items[i] = [json_data[i][0],json_data[i][1],json_data[i][2],json_data[i][3],json_data[i][4],json_data[i][5],json_data[i][6],json_data[i][7],json_data[i][8],json_data[i][9]]; 
                            
                        }
                        
                        return items;
                   }
                },
                responsive: true,
        orderCellsTop: true,  

       
        fixedHeader: true,
        initComplete: function () {
            var api = this.api();
 
            // For each column
            api
                .columns()
                .eq(0)
                
                .each(function (colIdx) {
                   
                    // Set the header cell to contain the input element
                  
                    var cell = $('.filters th').eq(
                        $(api.column(colIdx).header()).index()
                    );
                    var title = $(cell).text();
                    var id = $(cell).attr('data-id');
                    
                    $(cell).html('<input type="text" id="'+id+'" placeholder="' + title + '"  class="fs-14"   />');
                    
                    // On every keypress in this input
                    $(
                        'input',
                        $('.filters th').eq($(api.column(colIdx).header()).index())
                    )
                        .off('keyup change')
                        .on('change', function (e) {

                            console.log($(this).attr('id'));

                            if($(this).attr('id')=='datepicker-range'){
                                
                                api
                                .column(colIdx)
                                .search(
                                        function( data, colIdx ) {
                                            //var min = minDate;
                                            // var max = maxDate;
                                            // console.log(min);
                                                //date = new Date( colIdx[0] );
                                            var min = minDate;
                                            var max = maxDate;
                                            var date = new Date(data[0]);
                                            

                                            //colIdx
                                     
                                            if (
                                                ( min === null && max === null ) ||
                                                ( min === null && date <= max ) ||
                                                ( min <= date   && max === null ) ||
                                                ( min <= date   && date <= max )
                                            ) {
                                                return true;
                                                console.log('searching-date-start' +min  );
                                                console.log('searching-date-endt' +max  );
                                            }
                                            return false;
                                            console.log('searching-date-start' +min  );
                                            console.log('searching-date-endt' +max  );
                                        }
                                    
                                ).draw();
                               

                                
                            }
                            else{

                                    // Get the search value
                                $(this).attr('title', $(this).val());
                                var regexr = '({search})'; //$(this).parents('th').find('select').val();
                                var cursorPosition = this.selectionStart;
                                // Search the column for that value
                                api
                                .column(colIdx)
                                .search(
                                    this.value != ''
                                        ? regexr.replace('{search}', '(((' + this.value + ')))')
                                        : '',
                                    this.value != '',
                                    this.value == ''
                                )
                                .draw();


                            }
                            
                        })
                        .on('keyup', function (e) {
                            e.stopPropagation();
 
                            $(this).trigger('change');
                            $(this)
                                .focus()[0]
                                .setSelectionRange(cursorPosition, cursorPosition);
                        });
                });
                
        },
               
               
            });     
            flatpikrCall("datatableleadsC")
           
        }  
        
 function pageRedirect(variant){
        var fromdate=document.getElementById("fromdate").value
        var todate=document.getElementById("todate").value
        console.log("From date=================="+fromdate)
        console.log("To date======"+todate)
        console.log("Variant==================="+variant)
        // var url="{% url 'Admin:NewAccountsClick' %}"
                // window.location.href=url+"?&status="+variant+"&fromdate="+fromdate+"&todate="+todate

                var json_data;
                $("#datatableleads").DataTable({
                'paging':true, 
                'destroy': true,               
                'ajax':{
                   "url": "{% url 'Admin:NewAccountsClick' %}",
                   "type": "GET",
                   "data":{
                    'status':variant,
                    'fromdate':fromdate,
                    'todate':todate                    
                   },
                   "dataSrc":function(data){
                    json_data=data.data
                    count=data.count
                    console.log("Count========="+count[0])
                    var fundspan=document.getElementById("fundspan")
                    var nonfundspan=document.getElementById("nonfundspan")
                    var approvespan=document.getElementById("approvespan")
                    var waitingspan=document.getElementById("waitingspan")
                    fundspan.innerHTML=count[0]
                    nonfundspan.innerHTML=count[1]
                    approvespan.innerHTML=count[2]
                    waitingspan.innerHTML=count[3]
                    var items = [];
                    for ( var i=0, ien=json_data.length ; i<ien ; i++ ) {

                        items[i] = [json_data[i][1],json_data[i][0],json_data[i][2],json_data[i][3],json_data[i][4],json_data[i][5],json_data[i][6],json_data[i][9],json_data[i][8]]; 
                            
                        }
                        
                        return items;
                   }
                },
                responsive: true,
                orderCellsTop: true,
                fixedHeader: true,
                initComplete: function () {
                    var api = this.api();
     
                        api
                        .columns()
                        .eq(0)
                        .each(function (colIdx) {
                        var column = this;
             // Set the header cell to contain the input element

                 var cell = $('.filters th').eq(
                 $(api.column(colIdx).header()).index()
             );
             var $myindex=$(api.column(colIdx).header()).index();
             var $myhead=$("#datatableleads thead tr th").eq($myindex);
             var title = $myhead.text();
             var id = $myhead.attr('data-id');
             //var datatext=$(cell).attr('data-text');
             var select1 = $('<select   id="' + id + '" placeholder="' + title + '"  class="fs-14 form-control w-100"><option value=""></option></select>');
             if ($(cell).attr('data-text') == 'select') {
                 //console.log($(cell).index());
                 api.column($(cell).index())
                     .data()
                     .unique()
                     .sort()
                     .each(function (d, j) {


                         select1.append('<option value="' + d + '">' + d + '</option>');

                     });
                 $(cell).html(select1);




             } else {
                 $(cell).html('<input type="text" id="' + id + '" placeholder="' + title + '"  class="fs-14"   />');
             }


             // On every keypress in this input
             $(
                 'input',
                 $('.filters th').eq($(api.column(colIdx).header()).index())
             )
                 .off('keyup change')
                 .on('change', function (e) {

                     if ($(this).attr('id') == 'datepicker-range') {
                         console.log("Heloooo");

                         //var vals=this.value ;



                     } else {
                         //console.log($(this).attr('id'));


                         // Get the search value
                         $(this).attr('title', $(this).val());

                         //var vals=this.value ;

                         var regexr = '({search})'; //$(this).parents('th').find('select').val();

                         var cursorPosition = this.selectionStart;
                         // Search the column for that value
                         api
                             .column(colIdx)
                             .search(
                                 this.value != ''
                                     ? regexr.replace('{search}', '(((' + this.value + ')))')
                                     : '',
                                 this.value != '',
                                 this.value == ''
                             )
                             .draw();

                     }


                 })
                 .on('keyup', function (e) {
                     e.stopPropagation();

                     $(this).trigger('change');
                     $(this)
                         .focus()[0]
                         .setSelectionRange(cursorPosition, cursorPosition);
                 });

             $(
                 'select',
                 $('.filters th').eq($(api.column(colIdx).header()).index())
             )
                 .off('keyup change')
                 .on('change', function (e) {

                     if ($(this).attr('id') == 'datepicker-range') {
                         console.log("Heloooo");

                         //var vals=this.value ;



                     } else {
                         //console.log($(this).attr('id'));


                         // Get the search value
                         $(this).attr('title', $(this).val());

                         //var vals=this.value ;

                         var regexr = '({search})'; //$(this).parents('th').find('select').val();

                         var cursorPosition = this.selectionStart;
                         // Search the column for that value
                         api
                             .column(colIdx)
                             .search(
                                 this.value != ''
                                     ? regexr.replace('{search}', '(((' + this.value + ')))')
                                     : '',
                                 this.value != '',
                                 this.value == ''
                             )
                             .draw();

                     }

                 })
                 .on('keyup', function (e) {
                     e.stopPropagation();

                     $(this).trigger('change');
                     $(this)
                         .focus()[0]
                         .setSelectionRange(cursorPosition, cursorPosition);
                 });
         });
         flatpikrCall("datatableleads")
    },
                
               
            });  
 }


        function terminateAccount(change,status){
            

            // $('#datatableleadsT').dataTable().fnClearTable();
            //     $('#datatableleadsT').dataTable().fnDestroy();
            fromdate=document.getElementById("fromdate").value
            todate=document.getElementById("todate").value
            
                $("#datatableleadsT").DataTable({
                // 'processing' : true,
                
                'paging':true, 
                'destroy': true,               
                'ajax':{
                   "url": "{% url 'Admin:NewAccounts' %}",
                   "type": "GET",
                   
                   "data":{
                    'change':change,
                    'from':fromdate,
                    'to':todate,
                    'status':status,
                   },
                   "dataSrc":function(data){
                    
                    json_data=data.data
                    var items = [];
                    for ( var i=0, ien=json_data.length ; i<ien ; i++ ) {

                        items[i] = [json_data[i][0],json_data[i][1],json_data[i][2],json_data[i][3],json_data[i][4],json_data[i][5],json_data[i][6],json_data[i][7],json_data[i][8],json_data[i][9]]; 
                            
                        }
                        
                        return items;
                   }
                   
                },
                responsive: true,
                orderCellsTop: true,
                fixedHeader: true,
                initComplete: function () {
                    
                    var api = this.api();
     // For each column
                api
         .columns()
         .eq(0)
         .each(function (colIdx) {
             var column = this;
             // Set the header cell to contain the input element

             var cell = $('.filters th').eq(
                 $(api.column(colIdx).header()).index()
             );
             console.log("Celllllll"+cell)
             var $myindex=$(api.column(colIdx).header()).index();
             var $myhead=$("#datatableleadsT thead tr th").eq($myindex);
             var title = $myhead.text();
             var id = $myhead.attr('data-id');
             //var datatext=$(cell).attr('data-text');
             var select1 = $('<select   id="' + id + '" placeholder="' + title + '"  class="fs-14 form-control w-100"><option value=""></option></select>');
             if ($(cell).attr('data-text') == 'select') {
                 //console.log($(cell).index());
                 api.column($(cell).index())
                     .data()
                     .unique()
                     .sort()
                     .each(function (d, j) {


                         select1.append('<option value="' + d + '">' + d + '</option>');

                     });
                 $(cell).html(select1);




             } else {
                 $(cell).html('<input type="text" id="' + id + '" placeholder="' + title + '"  class="fs-14"   />');
             }


             // On every keypress in this input
             $(
                 'input',
                 $('.filters th').eq($(api.column(colIdx).header()).index())
             )
                 .off('keyup change')
                 .on('change', function (e) {

                     if ($(this).attr('id') == 'datepicker-range') {
                         console.log("Heloooo");

                         //var vals=this.value ;



                     } else {
                         //console.log($(this).attr('id'));


                         // Get the search value
                         $(this).attr('title', $(this).val());

                         //var vals=this.value ;

                         var regexr = '({search})'; //$(this).parents('th').find('select').val();

                         var cursorPosition = this.selectionStart;
                         // Search the column for that value
                         api
                             .column(colIdx)
                             .search(
                                 this.value != ''
                                     ? regexr.replace('{search}', '(((' + this.value + ')))')
                                     : '',
                                 this.value != '',
                                 this.value == ''
                             )
                             .draw();

                     }


                 })
                 .on('keyup', function (e) {
                     e.stopPropagation();

                     $(this).trigger('change');
                     $(this)
                         .focus()[0]
                         .setSelectionRange(cursorPosition, cursorPosition);
                 });

             $(
                 'select',
                 $('.filters th').eq($(api.column(colIdx).header()).index())
             )
                 .off('keyup change')
                 .on('change', function (e) {

                     if ($(this).attr('id') == 'datepicker-range') {
                         console.log("Heloooo");

                         //var vals=this.value ;



                     } else {
                         //console.log($(this).attr('id'));


                         // Get the search value
                         $(this).attr('title', $(this).val());

                         //var vals=this.value ;

                         var regexr = '({search})'; //$(this).parents('th').find('select').val();

                         var cursorPosition = this.selectionStart;
                         // Search the column for that value
                         api
                             .column(colIdx)
                             .search(
                                 this.value != ''
                                     ? regexr.replace('{search}', '(((' + this.value + ')))')
                                     : '',
                                 this.value != '',
                                 this.value == ''
                             )
                             .draw();

                     }

                 })
                 .on('keyup', function (e) {
                     e.stopPropagation();

                     $(this).trigger('change');
                     $(this)
                         .focus()[0]
                         .setSelectionRange(cursorPosition, cursorPosition);
                 });
         });
         flatpikrCall("datatableleadsT")
 },
                
               
            });     
            
           
        }    
        

function flatpikrCall(id){
    
    minDateFilter = "";
    maxDateFilter = "";


    //Flat Picker Date
    flatpickr('#datepicker-range', {

        //const fp = flatpickr(".test-calendar", {  altFormat: "F j, Y", dateFormat: "Y-m-d", showMonths: 3, disableMobile: true, inline: true, mode: "range", 
        //altInput: true,
        "allowInput": true,
        dateFormat: "Y-m-d",//MMMM Do YYYY
        altFormat: "Y-m-d",
        mode: "range",
        //enableTime: false,
        altInput: true, // Human Readable
        //minDate: new Date().fp_incr(-60), // 60 days from today
        //maxDate: defaultEnd,
        //locale: { firstDayOfWeek: 1},

        onChange:
            function (selectedDates, dateStr, instance) {
              
                var table = $('#'+id).DataTable();
                function rangefilter(ev, picker) {
                            minDateFilter = Date.parse(selectedDates[0]);
                            maxDateFilter = Date.parse(selectedDates[1]);
                            //console.log( 'maxDateFilter'+ maxDateFilter);
                            //console.log( 'minDateFilter'+ minDateFilter);
                           // console.log( $(this).index()+1);
                            $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                            var date = Date.parse(data[ $(this).index()+1]);
                        
                            if (
                            (isNaN(minDateFilter) && isNaN(maxDateFilter)) ||
                            (isNaN(minDateFilter) && date <= maxDateFilter) ||
                            (minDateFilter <= date && isNaN(maxDateFilter)) ||
                            (minDateFilter <= date && date <= maxDateFilter)
                            ) {
                            return true;
                            }
                            return false;
                        });
                        table.draw();
                        }

                rangefilter();
        },
        onReady: function (selectedDates, dateStr, instance) {
           
        },
          // https://codepen.io/bintux/pen/rgYeyp
        onClose: function (selectedDates, dateStr, instance) {
            var table = $('#datatableleads').DataTable();
            function rangefilter(ev, picker) {
                            minDateFilter = Date.parse(selectedDates[0]);
                            maxDateFilter = Date.parse(selectedDates[1]);
                            //console.log( 'maxDateFilter'+ maxDateFilter);
                            //console.log( 'minDateFilter'+ minDateFilter);
                           // console.log( $(this).index()+1);
                            $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                            var date = Date.parse(data[ $(this).index()+1]);
                        
                            if (
                            (isNaN(minDateFilter) && isNaN(maxDateFilter)) ||
                            (isNaN(minDateFilter) && date <= maxDateFilter) ||
                            (minDateFilter <= date && isNaN(maxDateFilter)) ||
                            (minDateFilter <= date && date <= maxDateFilter)
                            ) {
                            return true;
                            }
                            return false;
                        });
                        table.draw();
                        }

            rangefilter();

                         //console.log(selectedDates.attr('value'));
          
            
        }

    });

}


      
    </script>    

    <script src="{%static 'libs/flatpickr/flatpickr.min.js' %}"></script>
    <!-- Required datatable js -->
    <script src="{%static 'libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script src="{%static 'libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>


    <!-- Responsive examples -->
       <!---Commmented Now Later might needed
 
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
       -->  

    <!-- Datatable init js -->
    

    <!-- init js -->
    <!--<script src="assets/js/pages/form-advancedcustom.init.js"></script>-->

    <script src="{%static 'js/app.js' %}"></script>

    </body>

    </html>